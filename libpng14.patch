--- DevIL-1.7.8/devil-1.7.8/src-IL/src/il_png.c~	2009-03-08 08:10:09.000000000 +0100
+++ DevIL-1.7.8/devil-1.7.8/src-IL/src/il_png.c	2010-04-21 14:42:41.194560666 +0200
@@ -105,7 +105,11 @@
 	Read = iread(Signature, 1, 8);
 	iseek(-Read, IL_SEEK_CUR);
 
+#if PNG_LIBPNG_VER < 10400
 	return png_check_sig(Signature, 8);
+#else
+	return png_sig_cmp(Signature, 0, 8) == 0;
+#endif
 }
 
 
@@ -278,7 +282,11 @@
 
 	// Expand low-bit-depth grayscale images to 8 bits
 	if (png_color_type == PNG_COLOR_TYPE_GRAY && bit_depth < 8) {
+#if PNG_LIBPNG_VER < 10400
 		png_set_gray_1_2_4_to_8(png_ptr);
+#else
+		png_set_expand_gray_1_2_4_to_8(png_ptr);
+#endif
 	}
 
 	// Expand RGB images with transparency to full alpha channels
--- DevIL-1.7.8/devil-1.7.8/src-IL/src/il_icon.c~	2009-03-08 08:10:09.000000000 +0100
+++ DevIL-1.7.8/devil-1.7.8/src-IL/src/il_icon.c	2010-04-21 15:07:23.711078866 +0200
@@ -525,7 +525,11 @@
 
 	// Expand low-bit-depth grayscale images to 8 bits
 	if (ico_color_type == PNG_COLOR_TYPE_GRAY && bit_depth < 8) {
+#if PNG_LIBPNG_VER < 10400
 		png_set_gray_1_2_4_to_8(ico_png_ptr);
+#else
+		png_set_expand_gray_1_2_4_to_8(ico_png_ptr);
+#endif
 	}
 
 	// Expand RGB images with transparency to full alpha channels
--- DevIL-1.7.8/devil-1.7.8/m4/devil-definitions.m4.orig	2009-03-08 08:10:05.000000000 +0100
+++ DevIL-1.7.8/devil-1.7.8/m4/devil-definitions.m4	2010-10-15 09:31:19.551741882 +0200
@@ -244,12 +244,12 @@
 
 AC_DEFUN([SETTLE_PNG],
          [DEVIL_IL_LIB([png.h],
-                       [png12]) 
-          AS_IF([test "x$have_png12" = "xno"],
+                       [png]) 
+          AS_IF([test "x$have_png" = "xno"],
                 [DEVIL_IL_LIB([png.h],
-                              [png]) 
-                 lib_test_result="$have_png"],
-                [lib_test_result="$have_png12"]) 
+                              [png12]) 
+                 lib_test_result="$have_png12"],
+                [lib_test_result="$have_png"]) 
           AS_IF([test "x$lib_test_result" = "xyes"],
                 [MAYBE_OPTIONAL_DEPENDENCY([IL],
                                            [libpng]) ]) ]) 
